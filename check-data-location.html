<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            direction: ltr;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .info { background-color: #d6eaf8; color: #1f618d; }
        .warning { background-color: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>
        
        <div class="status info">
            <strong>Ø§Ù„ØºØ±Ø¶:</strong> Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ù…ÙƒØ§Ù† Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
        </div>

        <button onclick="checkLocalStorageData()">ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª localStorage</button>
        <button onclick="testBackendAPI()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù€ API Ø§Ù„Ø®Ù„ÙÙŠ</button>
        <button onclick="clearLocalStorage()">Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª localStorage</button>

        <h2>ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙÙŠ localStorage:</h2>
        <div id="localStorage-data" class="data-box">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª localStorage" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>

        <h2>ğŸŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API:</h2>
        <div id="api-status" class="data-box">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù€ API Ø§Ù„Ø®Ù„ÙÙŠ" Ù„ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</div>

        <h2>ğŸ“‹ Ø§Ù„ØªØ´Ø®ÙŠØµ:</h2>
        <div id="diagnosis" class="status info">
            <strong>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙØ­Øµ Ø¨Ø¹Ø¯
        </div>
    </div>

    <script>
        function checkLocalStorageData() {
            const safeData = localStorage.getItem('financial-safe-state');
            const projectsData = localStorage.getItem('financial-projects');
            const invoicesData = localStorage.getItem('financial-invoices');
            const employeesData = localStorage.getItem('financial-employees');
            const expensesData = localStorage.getItem('financial-expenses');

            let result = '';
            let hasData = false;

            if (safeData) {
                hasData = true;
                const parsed = JSON.parse(safeData);
                result += `ğŸ¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ localStorage:\n`;
                result += `Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${parsed.currentBalance} Ø¯ÙŠÙ†Ø§Ø±\n`;
                result += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${parsed.totalFunded} Ø¯ÙŠÙ†Ø§Ø±\n`;
                result += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†ÙØ§Ù‚: ${parsed.totalSpent} Ø¯ÙŠÙ†Ø§Ø±\n`;
                result += `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: ${parsed.transactions ? parsed.transactions.length : 0}\n\n`;
                
                if (parsed.transactions && parsed.transactions.length > 0) {
                    result += `Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:\n`;
                    parsed.transactions.slice(0, 3).forEach((t, i) => {
                        result += `${i+1}. ${t.description} - ${t.amount} Ø¯ÙŠÙ†Ø§Ø± (${t.date})\n`;
                    });
                }
            }

            if (projectsData) {
                const parsed = JSON.parse(projectsData);
                result += `\nğŸ“ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${parsed.length} Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ localStorage\n`;
            }

            if (invoicesData) {
                const parsed = JSON.parse(invoicesData);
                result += `ğŸ“„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: ${parsed.length} ÙØ§ØªÙˆØ±Ø© ÙÙŠ localStorage\n`;
            }

            if (employeesData) {
                const parsed = JSON.parse(employeesData);
                result += `ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†: ${parsed.length} Ù…ÙˆØ¸Ù ÙÙŠ localStorage\n`;
            }

            if (expensesData) {
                const parsed = JSON.parse(expensesData);
                result += `ğŸ’° Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${parsed.length} Ù…ØµØ±ÙˆÙ ÙÙŠ localStorage\n`;
            }

            if (!hasData) {
                result = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage';
                document.getElementById('diagnosis').innerHTML = `
                    <strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
                `;
                document.getElementById('diagnosis').className = 'status warning';
            } else {
                document.getElementById('diagnosis').innerHTML = `
                    <strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ localStorage (Ø§Ù„Ù…ØªØµÙØ­)
                    <br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø¨Ø¯ÙˆÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª)
                `;
                document.getElementById('diagnosis').className = 'status warning';
            }

            document.getElementById('localStorage-data').textContent = result;
        }

        async function testBackendAPI() {
            const apiUrl = 'http://localhost:8000';
            let result = '';

            try {
                // Test health endpoint
                result += 'ğŸ” ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...\n';
                const healthResponse = await fetch(`${apiUrl}/health`);
                
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    result += `âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„: ${healthData.message}\n\n`;
                    
                    // Test Safe API (without authentication for now)
                    result += 'ğŸ” ÙØ­Øµ API Ø§Ù„Ø®Ø²ÙŠÙ†Ø©...\n';
                    const safeResponse = await fetch(`${apiUrl}/api/safe/state`);
                    
                    if (safeResponse.ok) {
                        const safeData = await safeResponse.json();
                        result += `âœ… API Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙŠØ¹Ù…Ù„!\n`;
                        result += `Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${safeData.data.current_balance} Ø¯ÙŠÙ†Ø§Ø±\n`;
                        
                        document.getElementById('diagnosis').innerHTML = `
                            <strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¹Ù…Ù„Ø§Ù†!
                            <br><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„Ø§ ØªØ²Ø§Ù„ ØªØ³ØªØ®Ø¯Ù… localStorage
                            <br><strong>Ø§Ù„Ø­Ù„:</strong> Ù†Ø­ØªØ§Ø¬ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ØªØ³ØªØ®Ø¯Ù… API
                        `;
                        document.getElementById('diagnosis').className = 'status success';
                    } else if (safeResponse.status === 401) {
                        result += `ğŸ” API Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„\n`;
                        result += `Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ - API ÙŠØ¹Ù…Ù„ Ù„ÙƒÙ† ÙŠØ­ØªØ§Ø¬ Ù…ØµØ§Ø¯Ù‚Ø©\n`;
                        
                        document.getElementById('diagnosis').innerHTML = `
                            <strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ ÙˆAPI Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù…ØªØ§Ø­
                            <br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ÙŠØªØ·Ù„Ø¨ Ù…ØµØ§Ø¯Ù‚Ø© (Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ)
                            <br><strong>Ø§Ù„Ø­Ù„:</strong> Ù†Ø­ØªØ§Ø¬ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ØªØ³ØªØ®Ø¯Ù… API
                        `;
                        document.getElementById('diagnosis').className = 'status success';
                    } else {
                        result += `âŒ Ø®Ø·Ø£ ÙÙŠ API Ø§Ù„Ø®Ø²ÙŠÙ†Ø©: ${safeResponse.status}\n`;
                    }
                } else {
                    result += `âŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ÙŠØ¹Ù…Ù„: ${healthResponse.status}\n`;
                }
            } catch (error) {
                result += `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}\n`;
                result += `ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…: npm run dev ÙÙŠ Ù…Ø¬Ù„Ø¯ backend\n`;
                
                document.getElementById('diagnosis').innerHTML = `
                    <strong>Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­
                    <br><strong>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                    <br><strong>Ø§Ù„Ø£Ù…Ø±:</strong> cd backend && npm run dev
                `;
                document.getElementById('diagnosis').className = 'status warning';
            }

            document.getElementById('api-status').textContent = result;
        }

        function clearLocalStorage() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ localStorageØŸ')) {
                localStorage.removeItem('financial-safe-state');
                localStorage.removeItem('financial-projects');
                localStorage.removeItem('financial-invoices');
                localStorage.removeItem('financial-employees');
                localStorage.removeItem('financial-expenses');
                
                alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage');
                checkLocalStorageData();
            }
        }

        // Auto-check on page load
        window.onload = function() {
            checkLocalStorageData();
        };
    </script>
</body>
</html> 